<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        let cw = window.innerWidth;
        let ch = window.innerHeight;

        canvas.width = cw;
        canvas.height = ch;

        window.addEventListener('resize', function(event) {
            cw = window.innerWidth;
            ch = window.innerHeight;
            canvas.width = cw;
            canvas.height = ch;
            maxColumns = cw / fontSize;
        }, true);

        function getRandomKanji() {
            const kanjiRange = [0x4E00, 0x9FAF];
            const randomCode = Math.floor(Math.random() * (kanjiRange[1] - kanjiRange[0] + 1)) + kanjiRange[0];
            return String.fromCharCode(randomCode);
        }

        function getRandomColor() {
            const r = Math.floor(Math.random() * 256);
            const g = Math.floor(Math.random() * 256);
            const b = Math.floor(Math.random() * 256);
            return `rgb(${r},${g},${b})`;
        }

        let maxCharCount = 200;
        let fallingCharArr = [];
        let fontSize = 13;

        let frames = 0;

        class FallingChar {
            constructor(x, y, direction) {
                this.x = x;
                this.y = y;
                this.direction = direction;
                this.color = getRandomColor();
            }

            draw(ctx) {
                this.value = getRandomKanji();
                this.speed = (Math.random() * fontSize * 3) / 4 + (fontSize * 3) / 4;

                ctx.fillStyle = this.color;
                ctx.font = fontSize + "px sans-serif";
                ctx.fillText(this.value, this.x, this.y);

                switch (this.direction) {
                    case 'down':
                        this.y += this.speed;
                        if (this.y > ch) this.y = 0;
                        break;
                    case 'up':
                        this.y -= this.speed;
                        if (this.y < 0) this.y = ch;
                        break;
                    case 'left':
                        this.x -= this.speed;
                        if (this.x < 0) this.x = cw;
                        break;
                    case 'right':
                        this.x += this.speed;
                        if (this.x > cw) this.x = 0;
                        break;
                }
            }
        }

        let directions = ['up', 'down', 'left', 'right'];

        let update = () => {
            if (fallingCharArr.length < maxCharCount) {
                let direction = directions[Math.floor(Math.random() * directions.length)];
                let x, y;

                switch (direction) {
                    case 'down':
                        x = Math.random() * cw;
                        y = 0;
                        break;
                    case 'up':
                        x = Math.random() * cw;
                        y = ch;
                        break;
                    case 'left':
                        x = cw;
                        y = Math.random() * ch;
                        break;
                    case 'right':
                        x = 0;
                        y = Math.random() * ch;
                        break;
                }

                let fallingChar = new FallingChar(x, y, direction);
                fallingCharArr.push(fallingChar);
            }
            ctx.fillStyle = "rgba(0,0,0,0.05)";
            ctx.fillRect(0, 0, cw, ch);
            for (let i = 0; i < fallingCharArr.length && frames % 3 == 0; i++) {
                fallingCharArr[i].draw(ctx);
            }

            requestAnimationFrame(update);
            frames++;
        };

        update();
    </script>
</body>
</html>
