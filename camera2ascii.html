<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Art</title>
    <style>
        body {
            font-size: 14px; /* ç¸¦å¹…ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ */
        }
        #ascii-art {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
        }
        #canvas {
            display: none; /* ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’éè¡¨ç¤ºã«ã™ã‚‹ */
        }
    </style>
</head>
<body>
    <h1>æ–‡å­—ã®ç¸¦å¹…ã¨æ¨ªå¹…</h1>
    <p>é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
    <!-- ASCIIã‚¢ãƒ¼ãƒˆè¡¨ç¤ºç”¨ã®è¦ç´  -->
    <div id="ascii-art"></div>
    <!-- æç”»ç”¨ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
    <canvas id="canvas" width="200" height="200"></canvas>

    <script>
        const CHARACTERS = "abcdefghijkã‚ã„ã†ãˆãŠã‹ããã‘ã“æ¼¢å­—ğŸ˜ŠğŸ˜¡ğŸ˜°ğŸ™ˆğŸŸ¥ğŸŸ§ğŸŸ¨ğŸŸ©ğŸŸ¦ğŸŸªğŸŸ«â¬›â¬œ";
        const FONT = '16px sans-serif';
        const charWidths = {};
        const charColors = {}; // å„æ–‡å­—ã”ã¨ã®RGBå€¤ã‚’ä¿æŒã™ã‚‹è¾æ›¸

        function measureCharWidth(char) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            context.font = FONT;
            return context.measureText(char).width;
        }

        function recordCharWidths() {
            for (const char of CHARACTERS) {
                charWidths[char] = measureCharWidth(char);
            }
        }

        function analyzeTextColors(text, textWidth, font = FONT) {
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d", { willReadFrequently: true }); // willReadFrequentlyã‚’è¨­å®š

            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // èƒŒæ™¯ã‚’ç™½ã§å¡—ã‚Šã¤ã¶ã—
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ãƒ•ã‚©ãƒ³ãƒˆã‚’è¨­å®šã—ã¦æ–‡å­—ã®æç”»ç¯„å›²ã‚’è¨ˆæ¸¬
            ctx.font = font;
            const textHeight = parseInt(ctx.font, 10); // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’é«˜ã•ã®è¿‘ä¼¼å€¤ã¨ã—ã¦ä½¿ç”¨

            // æ–‡å­—ã‚’æç”»
            const x = 10; // æ–‡å­—ã®æç”»é–‹å§‹ä½ç½®ï¼ˆå·¦ä½™ç™½ï¼‰
            const y = textHeight + 10; // æ–‡å­—ã®æç”»é–‹å§‹ä½ç½®ï¼ˆä¸Šä½™ç™½ï¼‰
            ctx.fillStyle = "black";
            ctx.fillText(text, x, y);

            // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã®ãƒ”ã‚¯ã‚»ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const imageData = ctx.getImageData(x, y - textHeight, textWidth, textHeight);
            const data = imageData.data;

            let totalPixels = 0;
            let colorCounts = { r: 0, g: 0, b: 0, black: 0};

            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                const a = data[i + 3];

                if (a > 0) {
                    totalPixels++;
                    if (r === 0 && g === 0 && b === 0) {
                        colorCounts.black++;
                    }
                    colorCounts.r += r;
                    colorCounts.g += g;
                    colorCounts.b += b;
                }
            }

            // å¹³å‡RGBå€¤ã‚’è¨ˆç®—
            const avgR = Math.round(colorCounts.r / totalPixels);
            const avgG = Math.round(colorCounts.g / totalPixels);
            const avgB = Math.round(colorCounts.b / totalPixels);
            const avgBlack = (colorCounts.black / totalPixels)*100;
            return { r: avgR, g: avgG, b: avgB, black: avgBlack };
        }

        function recordCharColors() {
            for (const char of CHARACTERS) {
                const width = charWidths[char]; // charWidthsã‹ã‚‰æ¨ªå¹…ã‚’å–å¾—
                charColors[char] = analyzeTextColors(char, width);
            }
        }

        window.onload = function () {
            recordCharWidths();
            recordCharColors();
            
            console.log("Character widths:", charWidths);
            console.log("Character colors:", charColors);

            const asciiArtElement = document.getElementById("ascii-art");
            asciiArtElement.textContent = "Hello, ASCII Art!";
        };
    </script>
</body>
</html>
