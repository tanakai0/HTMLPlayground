<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Square jigsaw puzzle</title>
    <style>
        body {
            display: flex;
            margin: 10px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(var(--grid-dimension), var(--grid-interval-1));
            grid-template-rows: repeat(var(--grid-dimension), var(--grid-interval-1));
            gap: 1px;
            background-color: #ddd;
            outline: 2px solid #555;
        }
        .grid div {
            width: var(--grid-interval-1);
            height: var(--grid-interval-1);
            background-color: #fff;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="grid", id="grid"></div>

    <script>
        const GRID_INTERVAL = 20;
        const GRID_DIMENSION = 112;
        document.documentElement.style.setProperty('--grid-interval', `${GRID_INTERVAL}px`);
        document.documentElement.style.setProperty('--grid-interval-1', `${GRID_INTERVAL - 1}px`);
        document.documentElement.style.setProperty('--grid-dimension', `${GRID_DIMENSION}`);

        function generatePieceClass(n, color) {
            // Create style class
            const style = document.createElement('style');
            style.type = 'text/css';
            const size = GRID_INTERVAL * n;
            const className = `.piece${n} {
                width: ${size}px;
                height: ${size}px;
                background-color: ${color};
                position: absolute;
                cursor: grab;
                z-index: ${10000-n};
            }`;
            style.innerHTML = className;
            document.getElementsByTagName('head')[0].appendChild(style);

            // Create element
            const piece = document.createElement('div');
            piece.className = `piece${n}`;
            piece.id = `piece${n}`;
            document.body.appendChild(piece);
        }

        const dimensions = [
            2, 4, 6, 7, 8, 9, 11, 15, 16, 17, 18, 19, 24, 25, 27, 29, 33, 35 ,37, 42, 50
        ];

        const colors = [
            'Red', 'Green', 'Blue', 'Yellow', 'Orange', 'Purple', 'Pink', 'Cyan', 'Magenta', 'Lime',
            'Teal', 'Violet', 'Indigo', 'Coral', 'Turquoise', 'Chocolate', 'Olive', 'Maroon', 'Navy', 'Salmon', 'Gold'
        ];

        for (let i=0; i < dimensions.length; i++) {
            generatePieceClass(dimensions[i], colors[i]);
        }

        const gridElement = document.getElementById('grid');
        for (let i = 0; i < GRID_DIMENSION*GRID_DIMENSION; i++) {
            cell = document.createElement('div');
            gridElement.appendChild(cell);
        }

        let pieces = [];
        for (let i=0; i < dimensions.length; i++) {
            pieces.push(document.getElementById(`piece${dimensions[i]}`));
        }
        
        let selectedPiece = null;
        let offsetX, offsetY;

        pieces.forEach(piece => {
            piece.addEventListener('mousedown', (e) => {
                if (selectedPiece && selectedPiece !== piece) {
                    const selectedRect = selectedPiece.getBoundingClientRect();
                    const pieceRect = piece.getBoundingClientRect();
                    if (
                        pieceRect.left <= e.clientX &&
                        e.clientX <= pieceRect.right &&
                        pieceRect.top <= e.clientY &&
                        e.clientY <= pieceRect.bottom
                    ) {
                        selectedPiece = piece;
                    }
                } else {
                    selectedPiece = piece;
                }

                offsetX = e.pageX - selectedPiece.getBoundingClientRect().left - window.scrollX;
                offsetY = e.pageY - selectedPiece.getBoundingClientRect().top - window.scrollY;
                selectedPiece.style.cursor = 'grabbing';
                document.addEventListener('mousemove', onMouseMove);
            });
        });

        document.addEventListener('mouseup', () => {
            if (selectedPiece) {
                selectedPiece.style.cursor = 'grab';
                document.removeEventListener('mousemove', onMouseMove);

                // Snap piece to grid if within bounds
                const gridRect = document.querySelector('.grid').getBoundingClientRect();
                const pieceRect = selectedPiece.getBoundingClientRect();
                
                if (
                    pieceRect.left >= gridRect.left &&
                    pieceRect.top >= gridRect.top &&
                    pieceRect.right <= gridRect.right &&
                    pieceRect.bottom <= gridRect.bottom
                ) {
                    const gridX = Math.round((pieceRect.left - gridRect.left) / GRID_INTERVAL) * GRID_INTERVAL;
                    const gridY = Math.round((pieceRect.top - gridRect.top) / GRID_INTERVAL) * GRID_INTERVAL;
                    selectedPiece.style.left = `${gridX + gridRect.left + window.scrollX}px`;
                    selectedPiece.style.top = `${gridY + gridRect.top + window.scrollY}px`;
                }
                selectedPiece = null;
            }
        });

        function onMouseMove(e) {
            if (selectedPiece) {
                selectedPiece.style.left = `${e.pageX - offsetX}px`;
                selectedPiece.style.top = `${e.pageY - offsetY}px`;
            }
        }
    </script>
</body>
</html>
